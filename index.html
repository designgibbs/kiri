<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><title>Kiri:Moto Headless Slicer</title></head>
<body>
<script type="module">
  import { KIRI } from 'https://grid.space/code/kiri.js';

  const kiri = new KIRI({
    baseURL: 'https://grid.space/code/',
    mode: 'FDM',
    config: {
      device: {
        bedWidth: 256,
        bedDepth: 256,
        bedHeight: 256,
        nozzle: 0.4,
        filament: 1.75
      },
      process: {
        sliceHeight: 0.2,
        sliceShells: 3,
        sliceFillSparse: 0.15,
        sliceFillType: 'hex',
        sliceSupportEnable: false
      },
      print: {
        printSpeed: 60,
        retractionSpeed: 25
      },
      base: {
        stock: { x: 256, y: 256, z: 256, center: true }
      }
    }
  });

  window.addEventListener('message', async (event) => {
    if (!event.data || !event.data.stl) return;

    const decoded = Uint8Array.from(atob(event.data.stl), c => c.charCodeAt(0));
    await kiri.api.load({ name: 'model.stl', array: decoded });
    await kiri.api.slice();

    const stats = kiri.api.export();
    parent.postMessage({
      printTime: Math.ceil(stats.time / 60),
      grams: stats.weight.toFixed(1)
    }, '*');
  });
</script>
</body>
</html>
