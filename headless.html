<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8" /><title>Headless Kiri:Moto</title></head>
<body>
<script src="https://grid.space/code/kiri.js"></script>
<script>
  console.log("Headless Kiri:Moto Loaded");
  // Start Kiri in headless mode (no UI)
  kiri.start();

  // Example: listen for messages with base64 STL to slice
  window.addEventListener('message', e => {
    if (e.data && e.data.stl) {
      const base64stl = e.data.stl;
      (async () => {
        try {
          await kiri.work.loadSTLBase64(base64stl);
          await kiri.work.slice();

          const stats = kiri.work.stats;
          const filamentLengthMeters = (stats.length || 0) / 1000;
          const printTimeMinutes = (stats.time || 0) / 60;

          window.parent.postMessage({
            filamentLengthMeters: filamentLengthMeters.toFixed(2),
            printTimeMinutes: printTimeMinutes.toFixed(1),
            filamentGrams: (stats.filament || 0).toFixed(1)
          }, '*');
        } catch (err) {
          console.error("Slicing error:", err);
          window.parent.postMessage({ error: err.message }, '*');
        }
      })();
    }
  });
</script>
</body>
</html>
