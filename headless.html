<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Headless Kiri:Moto</title></head>
<body>
<script type="text/javascript" src="kiri.js"></script>
<script>
  console.log("Headless Kiri:Moto Loaded");

  window.addEventListener("message", async (e) => {
    const { stl } = e.data;
    if (!stl) return;

    const binary = Uint8Array.from(atob(stl), c => c.charCodeAt(0)).buffer;

    KIRI.codec.stl.toObject(binary, (vertices) => {
      // Dummy timing estimate for now
      const fakePrintTime = 45;
      const fakeGrams = 12;
      parent.postMessage({ printTime: fakePrintTime, grams: fakeGrams }, "*");
    });
  });
</script>
</body>
</html>